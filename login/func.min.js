onLoad=function(){$("#loader").hide();hello();getAll();getUser();getSiteInfo();dragMenu();$("#page").fadeToggle(800);$(".head").fadeToggle(800);$("#deletebutton").hide();$("#leveloption").hide();$("#menu_list").sortable("refresh");$("textarea#ckeditor").ckeditor()};fade=function(a){$(a).delay(10).fadeToggle("slow","linear").delay(1500).fadeToggle("slow","linear")};var currentEntry;var user;var siteinfo;$(document).ready(function(){$("#logo").click(linkhello);$("#linknew").click(linknew);$("#prefbtn").click(prefbtn);$("#submitbutton").click(submitbutton);$("#deletebutton").click(deletebutton);$("#updatesitebtn").click(updatesitebtn);$("#updateuserbtn").click(updateuserbtn);$("#leveldown").click(leveldown);$("#levelup").click(levelup)});function linkhello(){$("#hello").show();$("#edit").hide();$("#preferences").hide();return false}function linknew(){$("#hello").hide();$("#edit").show();$("#preferences").hide();$("#deletebutton").hide();$("#leveloption").hide();newEntry();return false}function prefbtn(){console.log("einstellungen");$("#hello").hide();$("#edit").hide();$("#preferences").toggle();return false}function submitbutton(){if($("#title").val()!=""){if($("#entryId").val()==""){addEntry()}else{updateEntry()}return false}}function deletebutton(){$("#edit").hide();deleteEntry();return false}function levelup(){var a=parseFloat($("#levelcount").text());if(a<levelsenabled){a++}updateLevel(a);return false}function leveldown(){var a=parseFloat($("#levelcount").text());if(a>=1){a--}updateLevel(a);return false}function updatesitebtn(){putSiteInfo();return false}function updateuserbtn(){putUser();return false}function menulink(){console.log("menulink");$("#hello").hide();$("#edit").show();$("#preferences").hide();getEntry($(this).data("identity"))}function hello(){$("#hello").show();$("#edit").hide();$("#preferences").hide()}$("img").error(function(){$(this).attr("src","css/bgbig.png")});function newEntry(){currentEntry={};renderEntry(currentEntry)}function getAll(){console.log("getAll");$.ajax({type:"GET",url:rootURL+"/entries?apikey="+apikey,dataType:"json",success:function(a){console.log("getAll success");renderList(a)}})}function getUser(){console.log("getUser");$.ajax({type:"GET",url:rootURL+"/user?apikey="+apikey,dataType:"json",success:function(a){$("#deletebutton").show();console.log("getUser success");user=a.user;renderUser(user)}})}function putUser(){console.log("putUser");$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/user",dataType:"json",data:updateUserToJSON(),success:function(b,c,a){fade("#savedfade");getUser()},error:function(a,c,b){alert("putUser error: "+c)}})}function getSiteInfo(){console.log("getSiteInfo");$.ajax({type:"GET",url:rootURL+"/siteinfo",dataType:"json",success:function(a){console.log("getSiteInfo success: "+a.siteinfo.site_title);siteinfo=a.siteinfo;renderSiteInfo(siteinfo)}})}function putSiteInfo(){console.log("putSiteInfo");$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/siteinfo",dataType:"json",data:updateSiteInfoToJSON(),success:function(b,c,a){fade("#savedfade");getSiteInfo()},error:function(a,c,b){alert("putSiteInfo error: "+c)}})}dragMenu=function(){console.log("dragMenu");$("#menu_list").sortable({placeholder:"dragger_placeholder",handle:".dragger",opacity:0.7,delay:150,appendTo:document.body,update:function(a,b){neworder=$("#menu_list").sortable("toArray");console.log(neworder);$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/entries/neworder",dataType:"json",data:JSON.stringify({apikey:apikey,neworder:neworder}),error:function(c,e,d){alert("newOrder error: "+e)}})}});$("#menu_list").disableSelection()};function getEntry(a){$.ajax({type:"GET",url:rootURL+"/entries/"+a+"?apikey="+apikey,dataType:"json",success:function(b){$("#deletebutton").show();$("#leveloption").show();currentEntry=b;renderEntry(currentEntry)}})}function addEntry(){console.log("addEntry");$.ajax({type:"POST",contentType:"application/json",url:rootURL+"/entries",dataType:"json",data:newEntryToJSON(),success:function(b,c,a){fade("#savedfade");getEntry(b.inserted.id);getAll()},error:function(a,c,b){alert("addEntry error: "+c)}})}function updateEntry(){console.log("updateEntry");$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/entries/"+$("#entryId").val(),dataType:"json",data:updateEntryToJSON(),success:function(b,c,a){fade("#savedfade");getEntry(b.updated.id);getAll()},error:function(a,c,b){alert("updateEntry error: "+c)}})}function updateLevel(a){console.log("updateLevel");console.log(a);$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/entries/"+$("#entryId").val()+"/level",dataType:"json",data:updateLevelToJSON(a),success:function(c,d,b){getEntry(c.updated.id);getAll()},error:function(b,d,c){alert("updateEntry error: "+d)}})}function deleteEntry(){console.log("deleteEntry");$.ajax({type:"DELETE",url:rootURL+"/entries/"+$("#entryId").val(),data:JSON.stringify({apikey:apikey}),success:function(b,c,a){fade("#deletedfade");getAll()},error:function(a,c,b){alert("deleteEntry error")}})}function renderList(b){console.log("renderList");var a=b.entries==null?[]:(b.entries instanceof Array?b.entries:[b.entries]);$("#menu_list li").remove();$.each(a,function(c,e){visible_class=e.visible?[]:" ishidden";visible_icon=e.visible?[]:'<i class="icon-eye-close eyeshut"></i>';visible_popup=e.visible?[]:'<span class="tooltip"><span>Wird auf der Webseite derzeit nicht angezeigt.</span></span>';levels="";if(levelsenabled>="1"&&e.levels>=1){for(var d=0;d<e.levels;d++){levels+='<span class="levels"></span>'}}$("#menu_list").append('<li id="'+e.id+'" class="row-split'+visible_class+'"><a href="#" class="menulink row-split" data-identity="'+e.id+'">'+levels+"<b>"+e.title+'</b><i class="icon-edit edit"></i> '+visible_icon+visible_popup+'</a><span class="dragger push-right"><i class="icon-reorder"></i></span></li>')});$("#menu_list li a").click(menulink)}function renderEntry(b){var a=b.entry;if(a!=null&&a.id!=null){date=new Date(a.mtime*1000).toUTCString();$("#editlegend").html('<i class="icon-edit"></i> Seite bearbeiten <span id="time">(letzte &Auml;nderung: '+date+"</span>");$("#entryId").val(a.id);$("#title").val(a.title);if(a.visible==1){$("#visiblecheckbox").attr("checked", "checked")}else{$("#visiblecheckbox").rempveAttr("checked")}$("textarea#ckeditor").val(a.content);$("#levelcount").text(a.levels);$("#deletebutton").html('<i class="icon-remove"></i> LÃ¶schen')}else{$("#editlegend").html('<i class="icon-pencil"></i> Neue Seite');$("#entryId").val("");$("#title").val("");$("textarea#ckeditor").val("")}}function renderUser(a){$("#useremail").val(a.user_email)}function renderSiteInfo(a){$("title").text(a.site_title+" - bearbeiten");$("#head-sitelink").html("<b>"+a.site_title+' <i class="icon-caret-right"></i></b>');$("#sitetitle").val(a.site_title);$("#siteheadline").val(a.site_headline);$("#sitetheme").val(a.site_theme)}function newEntryToJSON(){var a=JSON.stringify({apikey:apikey,title:$("#title").val(),content:$("#ckeditor").val(),visible:$("#visiblecheckbox").val(),});return a}function updateEntryToJSON(){var a=JSON.stringify({apikey:apikey,id:$("#entryId").val(),title:$("#title").val(),content:$("#ckeditor").val(),visible:$("#visiblecheckbox").is(":checked")});return a}function updateLevelToJSON(a){var b=JSON.stringify({apikey:apikey,level:a});return b}function updateSiteInfoToJSON(){var a=JSON.stringify({apikey:apikey,title:$("#sitetitle").val(),theme:$("#sitetheme").val(),headline:$("#siteheadline").val(),});return a}function updateUserToJSON(){var a=JSON.stringify({apikey:apikey,email:$("#useremail").val()});return a};