function linkhello(){return showRight("hello"),$(".menu-id").hide(),!1}function closepopup(){$(".popupoverflow").hide()}function linknew(){return showRight("edit"),$("#deletebutton").hide(),$("#siteprefsbtn").hide(),$("#leveloption").hide(),newEntry(),!1}function addChild(){console.log("addChild");var a=$(this).data("level"),b=$(this).data("pos");newLevel=a+1,newPos=b+1,linknew()}function prefbtn(){return console.log("einstellungen"),$("#hello").hide(),$("#edit").hide(),$("#preferences").toggle(),!1}function submitbutton(){return""!==$("#title").val()?(""===$("#entryId").val()?addEntry():updateEntry(),!1):void 0}function deletebutton(){return confirm("[OK] drücken um den Eintrag zu löschen.")?($("#edit").hide(),deleteEntry($(this).data("id")),!1):void 0}function levelup(){var a=parseFloat($("#levelcount").text());return a++,updateLevel(a),!1}function leveldown(){var a=parseFloat($("#levelcount").text());return a>=1&&a--,updateLevel(a),!1}function updatesiteinfobtn(){return putSiteInfo(),!1}function updateadminbtn(){return putAdmin(),!1}function submitnewusrbtn(){return postUser(),!1}function editusrbtn(){return getUserPrefs($(this).data("identity")),!1}function editsitebtn(){return getSitePrefs($(this).data("identity")),!1}function deleteusrbtn(){return confirm("[OK] drücken um den User zu löschen.")?($(".userpopup").hide(),deleteUser($(this).data("identity")),!1):void 0}function menulink(){console.log("menulink"),showRight("edit"),$(".menu-id").hide(),$("#flag_"+$(this).data("identity")).show(),getEntry($(this).data("identity"))}function langsel(){var a=$("#lang-sel").val();null!==$.cookie("LANGUAGE")&&$.removeCookie("LANGUAGE"),$.cookie("LANGUAGE",a),console.log("newLang: "+a),$("#changedlangfade").html(getLanguage()),fade("#changedlangfade"),"block"!==$("#preferences").css("display")&&showRight(""),getAll(),getSiteInfo(),currentEntry=""}function submitnewlang(){var a=$("input#newlanguage").val();""!==a&&postLanguage(a)}function deletelangbutton(){return confirm("[OK] drücken um die Sprache "+$(this).data("lang")+" zu löschen.")?(deleteLanguage($(this).data("lang")),!1):void 0}function newEntry(){currentEntry={},renderEntry(currentEntry)}function getLanguage(){return $.cookie("LANGUAGE")}function getLanguages(){console.log("getLanguages"),$.ajax({type:"GET",url:rootURL+"siteinfo?apikey="+apikey,dataType:"json",success:function(a){languages=a.siteinfo.languages,renderLanguages("#lang-sel")}})}function postLanguage(a){console.log("postLanguage"),$.ajax({type:"POST",contentType:"application/json",url:rootURL+"/siteinfo",dataType:"json",data:langToJSON(a),success:function(){console.log("postLang success"),fade("#savedfade"),getLanguages(),$("#newlanguage").val(""),getAll()},error:function(a){a.responseText.indexOf("UNIQUE")>-1&&alert("Diese Sprache existiert bereits."),console.log("postLang error: "+a.responseText),getLanguages(),$("#newlanguage").val("")}})}function deleteLanguage(a){$.ajax({type:"DELETE",url:rootURL+"/siteinfo/"+a,data:JSON.stringify({apikey:apikey}),success:function(){console.log("deleteLangSuccess: "+a),fade("#deletedfade"),getLanguages(),$.cookie("LANGUAGE")==a&&($.removeCookie("LANGUAGE"),$.cookie("LANGUAGE",languages[0])),getSiteInfo(),getAll()},error:function(){alert("deleteUser error: "+$("#user").val())}})}function getTemplates(){console.log("getTemplates"),$.ajax({type:"GET",url:rootURL+"availableTemplates?apikey="+apikey,dataType:"json",success:function(a){templates=a}})}function getAll(){console.log("getAll"),$.ajax({type:"GET",url:rootURL+"/entries/"+getLanguage()+"?apikey="+apikey,dataType:"json",success:function(a){console.log("getAll success"),renderList(a),sitelist=a}})}function getAdmin(){$.ajax({type:"GET",url:rootURL+"/users?admin=1&apikey="+apikey,dataType:"json",success:function(a){console.log("getAdmin success"),$("#deletebutton").show(),renderAdmin(a)}})}function putAdmin(){$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/users",dataType:"json",data:updateAdminToJSON(),success:function(){console.log("putAdmin success"),fade("#savedfade"),getAdmin()},error:function(a,b){alert("putAdmin error: "+b)}})}function getUsers(){$.ajax({type:"GET",url:rootURL+"/users?apikey="+apikey,dataType:"json",success:function(a){$("#deletebutton").show(),console.log("getUsers success"),renderUserList(a)}})}function postUser(){$.ajax({type:"POST",contentType:"application/json",url:rootURL+"/users",dataType:"json",data:userToJSON(),success:function(){console.log("postUser success"),fade("#savedfade"),getUsers(),$("#newuseremail").val("")},error:function(a){a.responseText.indexOf("UNIQUE")>-1&&alert("Dieser Nutzer existiert bereits."),console.log("postUser error: "+a.responseText),getUsers(),$("#newuseremail").val("")}})}function getUserPrefs(a){console.log("getUserPrefs"),$.ajax({type:"GET",url:rootURL+"/users/"+a+"?apikey="+apikey,dataType:"json",success:function(b){getAll(),renderUser(b,a)},error:function(a,b){alert("getUser error: "+b)}})}function deleteUser(a){$.ajax({type:"DELETE",url:rootURL+"/users/"+a,data:JSON.stringify({apikey:apikey}),success:function(){console.log("deleteUsersuccess: "+a),fade("#deletedfade"),getUsers()},error:function(){alert("deleteUser error: "+$("#user").val())}})}function getSitePrefs(a){console.log("getSitePrefs"),$.ajax({type:"GET",url:rootURL+"/entries/"+getLanguage()+"/"+a+"?apikey="+apikey,dataType:"json",success:function(b){getAll(),renderSitePopup(b,a)},error:function(a,b){alert("getSite error: "+b)}})}function getSiteInfo(){$.ajax({type:"GET",url:rootURL+"/siteinfo/"+getLanguage(),dataType:"json",success:function(a){console.log("getSiteInfo success: "+a.siteinfo.site_title),siteinfo=a.siteinfo,renderSiteInfo(siteinfo)}})}function putSiteInfo(){console.log("putSiteInfo"),$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/siteinfo",dataType:"json",data:updateSiteInfoToJSON(),success:function(){fade("#savedfade"),getSiteInfo(),getAll()},error:function(a,b){alert("putSiteInfo error: "+b)}})}function getEntry(a){console.log("getEntry"),$.ajax({type:"GET",url:rootURL+"/entries/"+getLanguage()+"/"+a+"?apikey="+apikey,dataType:"json",success:function(a){$("#deletebutton").show(),$("#leveloption").show(),currentEntry=a,renderEntry(currentEntry)},error:function(a,b){alert("getEntry error: "+b)}})}function addEntry(){console.log("addEntry"),$.ajax({type:"POST",contentType:"application/json",url:rootURL+"/entries/"+getLanguage(),dataType:"json",data:newEntryToJSON(),success:function(a){fade("#savedfade"),getEntry(a.inserted.id),getAll(),newPos=null,newLevel=0},error:function(a,b){newPos=null,newLevel=0,alert("addEntry error: "+b)}})}function updateEntry(){console.log("updateEntry"),$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/entries/"+getLanguage()+"/"+$("#entryId").val(),dataType:"json",data:updateEntryToJSON(),success:function(a){fade("#savedfade"),getEntry(a.updated.id),getAll()},error:function(a,b){alert("updateEntry error: "+b)}})}function deleteEntry(a){console.log("deleteEntry"),$.ajax({type:"DELETE",url:rootURL+"/entries/"+getLanguage()+"/"+a,data:JSON.stringify({apikey:apikey}),success:function(){fade("#deletedfade"),getAll()},error:function(){alert("deleteEntry error")}})}function updateLevel(a){console.log("updateLevel"),console.log(a),$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/entries/"+getLanguage()+"/"+$("#entryId").val()+"/level",dataType:"json",data:updateLevelToJSON(a),success:function(){getEntry($("#entryId").val()),getAll()},error:function(a,b){alert("updateEntry error: "+b)}})}function renderList(a){console.log("renderList");var b=null===a.entries?[]:a.entries instanceof Array?a.entries:[a.entries];$("#menu_list li").remove(),$.each(b,function(a,b){if(visible_class=b.visible?[]:" ishidden",visible_icon=b.visible?[]:'<i class="icon-eye-shut eyeshut"></i>',visible_popup=b.visible?[]:'<span class="tooltip"><span>Wird auf der Webseite derzeit nicht angezeigt.</span></span>',levels="",$("#levelstarget").val()===!0&&b.level>=1)for(var c=0;c<b.level;c++)levels+='<span class="levels"></span>';var d="";$("#levelstarget").val()===!0&&($("a.menulink").addClass("smallMenulink"),d='<a href="#" class="addChild-Button" data-level="'+b.level+'" data-identity="'+b.id+'"data-pos="'+b.pos+'">+</a>'),$("#menu_list").append('<li id="'+b.id+'" class="row-split'+visible_class+'"><a href="#" class="menulink row-split" data-identity="'+b.id+'">'+levels+"<b>"+b.title+'</b><i class="icon-edit edit"></i> '+visible_icon+visible_popup+"</a>"+d+'<span class="dragger push-right"><i class="icon-drag"></i></span></li>')}),$("#levelstarget").val()===!0&&$("a.menulink").addClass("smallMenulink"),$("#menu_list li a.menulink").unbind().click(menulink),$(".addChild-Button").unbind().click(addChild)}function renderEntry(a){var b;b="undefined"==typeof a.template?"ws-edit-default":a.template,$("#edit_main").load("templates/"+b,function(){"ws-edit-default"==b&&$("textarea#ckeditor").ckeditor(),$("#submitbutton").unbind().click(submitbutton),$("#deletebutton").unbind().click(deletebutton),$("#leveldown").unbind().click(leveldown),$("#levelup").unbind().click(levelup);var c=a.entry;null!==c&&null!==c.id?(date=new Date(1e3*c.mtime).toUTCString(),$("#editlegend").html('<i class="icon-edit"></i> Seite bearbeiten <span id="time">(letzte &Auml;nderung: '+date+"</span>"),$("#entryId").val(c.id),$("#title").val(c.title),c.visible===!0?$("#visiblecheckbox").attr("checked","checked"):$("#visiblecheckbox").removeAttr("checked"),$("textarea#ckeditor").val(c.content),$("#levelcount").text(c.level),$("#levelstarget").val()===!0?$("#leveloption").show():$("#leveloption").hide(),$("#deletebutton").attr("data-id",a.entry.id).html('<i class="icon-cancel"></i> Löschen')):($("#editlegend").html('<i class="icon-pencil"></i> Neue Seite'),$("#entryId").val(""),$("#title").val(""),$("textarea#ckeditor").val(""),$("#levelstarget").val()===!0?$("#leveloption").show():$("#leveloption").hide())})}function renderAdmin(a){console.log("renderAdmin");var b=null===a.users?[]:a.users instanceof Array?a.users:[a.users];$.each(b,function(a,b){$("#adminemail").val(b.user_email)})}function renderUserList(a){console.log("renderUserList");var b=null===a.users?[]:a.users instanceof Array?a.users:[a.users];$("#user-list li").remove(),$.each(b,function(a,b){$("#user-list").append($("<li>").addClass("push").append(b.user_email).append($('<a href="#">').addClass("editusrbutton btn push-right").attr("data-identity",b.id).text("Bearbeiten")))}),$(".editusrbutton").unbind().click(editusrbtn)}function renderSiteInfo(a){$("title").text(a.site_title+" - bearbeiten"),$("#head-sitelink").html("<b>"+a.site_title+' <i class="icon-angle-right"></i></b>'),$("#sitetitle").val(a.site_title),$("#siteheadline").val(a.site_headline),$("#sitetheme").val(a.site_theme),$("#levelstarget").val(a.site_levels),$("#levels .btn").removeClass("btn-active"),button()}function renderUser(a,b){console.log("renderUser"),$(".userpopup").show(),renderTemplateList("#usertemplate"),$(".userpopuptitle").text(a.user_email+" - Eigenschaften");var c=null===sitelist.entries?[]:sitelist.entries instanceof Array?sitelist.entries:[sitelist.entries];$(".userpopup-sitelist li").remove(),$.each(c,function(a,b){$(".userpopup-sitelist").append($("<li>").append($("<label>").addClass("bold").text(b.title)).append($("<input>").addClass("userpopupcheckbox").attr("type","checkbox").attr("data-id",b.id)))});var d=null===a.sites?[]:a.sites instanceof Array?a.sites:[a.sites];$.each(d,function(a,b){$(".userpopup-sitelist input.userpopupcheckbox[data-id="+b+"]").attr("checked","checked")}),$("#deleteusrbutton").attr("data-identity",b),$("#deleteusrbutton").unbind().click(deleteusrbtn)}function renderSitePopup(a){console.log("renderSitePopup"),$(".editpopup").show(),renderTemplateList("#templateSelector"),$(".sitepopuptitle").text(a.title+" - Eigenschaften")}function renderLanguages(a){$(a).html($("<option disabled>").html("Sprache/Language")),$("#language-list").html(""),$.each(languages,function(b,c){$(a).append($("<option></option>").val(c).html(c).attr("selected",c==siteinfo.site_language)),$("#language-list").append($("<li>").addClass("push").append(c).append(siteinfo.default_language!==c?$('<a href="#">').addClass("deletelangbutton btn redbtn push-right").attr("data-lang",c).text("Löschen"):""))}),$(".deletelangbutton").unbind().click(deletelangbutton)}function renderTemplateList(a){console.log("renderTemplateList"),$(a).html(""),$.each(templates,function(b,c){var d=c;"ws-edit-default"===d&&(d="default"),"ws-"!==d.substring(0,3)&&$(a).append($("<option></option>").val(c).html(d).attr("selected","undefined"!=typeof currentEntry?c==currentEntry.template:""))})}function newEntryToJSON(){return data=JSON.stringify({apikey:apikey,title:$("#title").val(),content:$("#ckeditor").val(),visible:$("#visiblecheckbox").is(":checked"),pos:newPos,level:newLevel,parentpos:null===newPos?null:newPos-1,language:getLanguage()}),data}function updateEntryToJSON(){return data=JSON.stringify({apikey:apikey,id:$("#entryId").val(),title:$("#title").val(),content:$("#ckeditor").val(),visible:$("#visiblecheckbox").is(":checked"),language:getLanguage()}),data}function updateLevelToJSON(a){return data=JSON.stringify({apikey:apikey,value:a}),data}function newOrderToJSON(a){return data=JSON.stringify({apikey:apikey,neworder:a,language:getLanguage()}),data}function updateSiteInfoToJSON(){return data=JSON.stringify({apikey:apikey,title:$("#sitetitle").val(),theme:$("#sitetheme").val(),headline:$("#siteheadline").val(),levels:$("#levelstarget").val(),language:getLanguage()}),data}function updateAdminToJSON(){return data=JSON.stringify({apikey:apikey,email:$("#adminemail").val()}),data}function userToJSON(){return data=JSON.stringify({apikey:apikey,email:$("#newuseremail").val()}),data}function langToJSON(a){return data=JSON.stringify({apikey:apikey,language:a}),data}fade=function(a){$(a).delay(10).fadeToggle("slow","linear").delay(1500).fadeToggle("slow","linear")},usermailvalidate=function(a){return a.indexOf(".")>2&&a.indexOf("@")>0?(submitnewusrbtn(),!0):($("#submituserbtn").after('<br><div class="descr error">Keine gültige Emailadresse</div>'),void console.log("Email nicht gueltig bei useremail"))},adminmailvalidate=function(a){return a.indexOf(".")>2&&a.indexOf("@")>0?(updateadminbtn(),!0):($("#updateadminbtn").after('<br><div class="descr error">Keine gültige Emailadresse</div>'),void console.log("Email nicht gueltig bei adminemail"))},showRight=function(a){$(".rightpanel").each(function(){$(this).hide()}),a.match("^#")?$(a).show():$("#"+a).show()},$("img").error(function(){$(this).attr("src","static/img/bgbig.png")}),init=function(){console.log("init"),$("#logo").click(linkhello),$("#linknew").click(linknew),$("#prefbtn").click(prefbtn),$("#lang-sel").change(langsel),$(".closepopup").click(closepopup),$(".popupoverflow").click(closepopup),$(".popupcontent").click(function(a){a.stopPropagation()}),$("#submitlangbtn").click(submitnewlang),$("#updatesiteinfobtn").click(updatesiteinfobtn),$("#siteprefsbtn").click(editsitebtn)},dragMenu=function(){console.log("dragMenu");var a=$("#menu_list");a.sortable({placeholder:"dragger_placeholder",handle:".dragger",opacity:.7,delay:150,appendTo:document.body,update:function(){console.log("update");var a=$("#menu_list").sortable("toArray");console.log(a),$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/entries/neworder",dataType:"json",data:newOrderToJSON(a),error:function(a,b,c){console.log("newOrder error: "+b+c)}})}}),a.disableSelection()},$(document).ready(init()),onLoad=function(){$("#loader").hide(),linkhello(),getAdmin(),getUsers(),getSiteInfo(),getAll(),dragMenu(),getLanguages(),getTemplates(),$("#page").fadeToggle(800),$(".head").fadeToggle(800),$("#deletebutton").hide(),$("#leveloption").hide(),$("#menu_list").sortable("refresh"),$("textarea#ckeditor").ckeditor()};var currentEntry,templates,languages,sitelist,user,siteinfo,rootURL="../api/index.php",newPos=null,newLevel=0,langSelected=getLanguage();