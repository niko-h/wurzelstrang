!function(a,b){function c(){return showRight("hello"),$(".menu-id").hide(),!1}function d(){$(".popupoverflow").hide()}function e(){return showRight("edit"),$("#deletebutton").hide(),$("#siteprefsbtn").hide(),$("#leveloption").hide(),v(),!1}function f(){console.log("addChild");var a=$(this).data("level"),b=$(this).data("pos");nb=a+1,mb=b+1,e()}function g(){return console.log("einstellungen"),$("#hello").hide(),$("#edit").hide(),$("#preferences").toggle(),!1}function h(){return""!==$("#title").val()?(""===$("#entryId").val()?M():N(),!1):void 0}function i(){return confirm("[OK] drücken um den Eintrag zu löschen.")?($("#edit").hide(),O($(this).data("id")),!1):void 0}function j(){var a=parseFloat($("#levelcount").text());return a++,P(a),!1}function k(){var a=parseFloat($("#levelcount").text());return a>=1&&a--,P(a),!1}function l(){return K(),!1}function m(){return D(),!1}function n(){return F(),!1}function o(){return G($(this).data("identity")),!1}function p(){return I($(this).data("identity")),!1}function q(){return confirm("[OK] drücken um den User zu löschen.")?($(".userpopup").hide(),H($(this).data("identity")),!1):void 0}function r(){console.log("menulink"),showRight("edit"),$(".menu-id").hide(),$("#flag_"+$(this).data("identity")).show(),L($(this).data("identity"))}function s(){var a=$("#lang-sel").val();null!==$.cookie("LANGUAGE")&&$.removeCookie("LANGUAGE"),$.cookie("LANGUAGE",a),console.log("newLang: "+a),$("#changedlangfade").html(w()),fade("#changedlangfade"),"block"!==$("#preferences").css("display")&&showRight(""),B(),J(),gb=""}function t(){var a=$("input#newlanguage").val();""!==a&&y(a)}function u(){return confirm("[OK] drücken um die Sprache "+$(this).data("lang")+" zu löschen.")?(z($(this).data("lang")),!1):void 0}function v(){gb={},R(gb)}function w(){return $.cookie("LANGUAGE")}function x(){console.log("getLanguages"),$.ajax({type:"GET",url:lb+"siteinfo?apikey="+apikey,dataType:"json",success:function(a){ib=a.siteinfo.languages,X("#lang-sel")}})}function y(a){console.log("postLanguage"),$.ajax({type:"POST",contentType:"application/json",url:lb+"/siteinfo",dataType:"json",data:fb(a),success:function(){console.log("postLang success"),fade("#savedfade"),x(),$("#newlanguage").val(""),B()},error:function(a){a.responseText.indexOf("UNIQUE")>-1&&alert("Diese Sprache existiert bereits."),console.log("postLang error: "+a.responseText),x(),$("#newlanguage").val("")}})}function z(a){$.ajax({type:"DELETE",url:lb+"/siteinfo/"+a,data:JSON.stringify({apikey:apikey}),success:function(){console.log("deleteLangSuccess: "+a),fade("#deletedfade"),x(),$.cookie("LANGUAGE")==a&&($.removeCookie("LANGUAGE"),$.cookie("LANGUAGE",ib[0])),J(),B()},error:function(){alert("deleteUser error: "+$("#user").val())}})}function A(){console.log("getTemplates"),$.ajax({type:"GET",url:lb+"availableTemplates?apikey="+apikey,dataType:"json",success:function(a){hb=a}})}function B(){console.log("getAll"),$.ajax({type:"GET",url:lb+"/entries/"+w()+"?apikey="+apikey,dataType:"json",success:function(a){console.log("getAll success"),Q(a),jb=a}})}function C(){$.ajax({type:"GET",url:lb+"/users?admin=1&apikey="+apikey,dataType:"json",success:function(a){console.log("getAdmin success"),$("#deletebutton").show(),S(a)}})}function D(){$.ajax({type:"PUT",contentType:"application/json",url:lb+"/users",dataType:"json",data:db(),success:function(){console.log("putAdmin success"),fade("#savedfade"),C()},error:function(a,b){alert("putAdmin error: "+b)}})}function E(){$.ajax({type:"GET",url:lb+"/users?apikey="+apikey,dataType:"json",success:function(a){$("#deletebutton").show(),console.log("getUsers success"),T(a)}})}function F(){$.ajax({type:"POST",contentType:"application/json",url:lb+"/users",dataType:"json",data:eb(),success:function(){console.log("postUser success"),fade("#savedfade"),E(),$("#newuseremail").val("")},error:function(a){a.responseText.indexOf("UNIQUE")>-1&&alert("Dieser Nutzer existiert bereits."),console.log("postUser error: "+a.responseText),E(),$("#newuseremail").val("")}})}function G(a){console.log("getUserPrefs"),$.ajax({type:"GET",url:lb+"/users/"+a+"?apikey="+apikey,dataType:"json",success:function(b){B(),V(b,a)},error:function(a,b){alert("getUser error: "+b)}})}function H(a){$.ajax({type:"DELETE",url:lb+"/users/"+a,data:JSON.stringify({apikey:apikey}),success:function(){console.log("deleteUsersuccess: "+a),fade("#deletedfade"),E()},error:function(){alert("deleteUser error: "+$("#user").val())}})}function I(a){console.log("getSitePrefs"),$.ajax({type:"GET",url:lb+"/entries/"+w()+"/"+a+"?apikey="+apikey,dataType:"json",success:function(b){B(),W(b,a)},error:function(a,b){alert("getSite error: "+b)}})}function J(){$.ajax({type:"GET",url:lb+"/siteinfo/"+w(),dataType:"json",success:function(a){console.log("getSiteInfo success: "+a.siteinfo.site_title),kb=a.siteinfo,U(kb)}})}function K(){console.log("putSiteInfo"),$.ajax({type:"PUT",contentType:"application/json",url:lb+"/siteinfo",dataType:"json",data:cb(),success:function(){fade("#savedfade"),J(),B()},error:function(a,b){alert("putSiteInfo error: "+b)}})}function L(a){console.log("getEntry"),$.ajax({type:"GET",url:lb+"/entries/"+w()+"/"+a+"?apikey="+apikey,dataType:"json",success:function(a){$("#deletebutton").show(),$("#leveloption").show(),gb=a,R(gb)},error:function(a,b){alert("getEntry error: "+b)}})}function M(){console.log("addEntry"),$.ajax({type:"POST",contentType:"application/json",url:lb+"/entries/"+w(),dataType:"json",data:Z(),success:function(a){fade("#savedfade"),L(a.inserted.id),B(),mb=null,nb=0},error:function(a,b){mb=null,nb=0,alert("addEntry error: "+b)}})}function N(){console.log("updateEntry"),$.ajax({type:"PUT",contentType:"application/json",url:lb+"/entries/"+w()+"/"+$("#entryId").val(),dataType:"json",data:_(),success:function(a){fade("#savedfade"),L(a.updated.id),B()},error:function(a,b){alert("updateEntry error: "+b)}})}function O(a){console.log("deleteEntry"),$.ajax({type:"DELETE",url:lb+"/entries/"+w()+"/"+a,data:JSON.stringify({apikey:apikey}),success:function(){fade("#deletedfade"),B()},error:function(){alert("deleteEntry error")}})}function P(a){console.log("updateLevel"),console.log(a),$.ajax({type:"PUT",contentType:"application/json",url:lb+"/entries/"+w()+"/"+$("#entryId").val()+"/level",dataType:"json",data:ab(a),success:function(){L($("#entryId").val()),B()},error:function(a,b){alert("updateEntry error: "+b)}})}function Q(a){console.log("renderList");var b=null===a.entries?[]:a.entries instanceof Array?a.entries:[a.entries];$("#menu_list li").remove(),$.each(b,function(a,b){if(visible_class=b.visible?[]:" ishidden",visible_icon=b.visible?[]:'<i class="icon-eye-shut eyeshut"></i>',visible_popup=b.visible?[]:'<span class="tooltip"><span>Wird auf der Webseite derzeit nicht angezeigt.</span></span>',levels="",$("#levelstarget").val()===!0&&b.level>=1)for(var c=0;c<b.level;c++)levels+='<span class="levels"></span>';var d="";$("#levelstarget").val()===!0&&($("a.menulink").addClass("smallMenulink"),d='<a href="#" class="addChild-Button" data-level="'+b.level+'" data-identity="'+b.id+'"data-pos="'+b.pos+'">+</a>'),$("#menu_list").append('<li id="'+b.id+'" class="row-split'+visible_class+'"><a href="#" class="menulink row-split" data-identity="'+b.id+'">'+levels+"<b>"+b.title+'</b><i class="icon-edit edit"></i> '+visible_icon+visible_popup+"</a>"+d+'<span class="dragger push-right"><i class="icon-drag"></i></span></li>')}),$("#levelstarget").val()===!0&&$("a.menulink").addClass("smallMenulink"),$("#menu_list li a.menulink").unbind().click(r),$(".addChild-Button").unbind().click(f)}function R(a){var b;b="undefined"==typeof a.template?"ws-edit-default":a.template,$("#edit_main").load("templates/"+b,function(){"ws-edit-default"==b&&$("textarea#ckeditor").ckeditor(),$("#submitbutton").unbind().click(h),$("#deletebutton").unbind().click(i),$("#leveldown").unbind().click(k),$("#levelup").unbind().click(j);var c=a.entry;null!==c&&null!==c.id?(date=new Date(1e3*c.mtime).toUTCString(),$("#editlegend").html('<i class="icon-edit"></i> Seite bearbeiten <span id="time">(letzte &Auml;nderung: '+date+"</span>"),$("#entryId").val(c.id),$("#title").val(c.title),c.visible===!0?$("#visiblecheckbox").attr("checked","checked"):$("#visiblecheckbox").removeAttr("checked"),$("textarea#ckeditor").val(c.content),$("#levelcount").text(c.level),$("#levelstarget").val()===!0?$("#leveloption").show():$("#leveloption").hide(),$("#deletebutton").attr("data-id",a.entry.id).html('<i class="icon-cancel"></i> Löschen')):($("#editlegend").html('<i class="icon-pencil"></i> Neue Seite'),$("#entryId").val(""),$("#title").val(""),$("textarea#ckeditor").val(""),$("#levelstarget").val()===!0?$("#leveloption").show():$("#leveloption").hide())})}function S(a){console.log("renderAdmin");var b=null===a.users?[]:a.users instanceof Array?a.users:[a.users];$.each(b,function(a,b){$("#adminemail").val(b.user_email)})}function T(a){console.log("renderUserList");var b=null===a.users?[]:a.users instanceof Array?a.users:[a.users];$("#user-list li").remove(),$.each(b,function(a,b){$("#user-list").append($("<li>").addClass("push").append(b.user_email).append($('<a href="#">').addClass("editusrbutton btn push-right").attr("data-identity",b.id).text("Bearbeiten")))}),$(".editusrbutton").unbind().click(o)}function U(a){$("title").text(a.site_title+" - bearbeiten"),$("#head-sitelink").html("<b>"+a.site_title+' <i class="icon-angle-right"></i></b>'),$("#sitetitle").val(a.site_title),$("#siteheadline").val(a.site_headline),$("#sitetheme").val(a.site_theme),$("#levelstarget").val(a.site_levels),$("#levels .btn").removeClass("btn-active"),button()}function V(a,b){console.log("renderUser"),$(".userpopup").show(),Y("#usertemplate"),$(".userpopuptitle").text(a.user_email+" - Eigenschaften");var c=null===jb.entries?[]:jb.entries instanceof Array?jb.entries:[jb.entries];$(".userpopup-sitelist li").remove(),$.each(c,function(a,b){$(".userpopup-sitelist").append($("<li>").append($("<label>").addClass("bold").text(b.title)).append($("<input>").addClass("userpopupcheckbox").attr("type","checkbox").attr("data-id",b.id)))});var d=null===a.sites?[]:a.sites instanceof Array?a.sites:[a.sites];$.each(d,function(a,b){$(".userpopup-sitelist input.userpopupcheckbox[data-id="+b+"]").attr("checked","checked")}),$("#deleteusrbutton").attr("data-identity",b),$("#deleteusrbutton").unbind().click(q)}function W(a){console.log("renderSitePopup"),$(".editpopup").show(),Y("#templateSelector"),$(".sitepopuptitle").text(a.title+" - Eigenschaften")}function X(a){$(a).html($("<option disabled>").html("Sprache/Language")),$("#language-list").html(""),$.each(ib,function(b,c){$(a).append($("<option></option>").val(c).html(c).attr("selected",c==kb.site_language)),$("#language-list").append($("<li>").addClass("push").append(c).append(kb.default_language!==c?$('<a href="#">').addClass("deletelangbutton btn redbtn push-right").attr("data-lang",c).text("Löschen"):""))}),$(".deletelangbutton").unbind().click(u)}function Y(a){console.log("renderTemplateList"),$(a).html(""),$.each(hb,function(b,c){var d=c;"ws-edit-default"===d&&(d="default"),"ws-"!==d.substring(0,3)&&$(a).append($("<option></option>").val(c).html(d).attr("selected","undefined"!=typeof gb?c==gb.template:""))})}function Z(){return data=JSON.stringify({apikey:apikey,title:$("#title").val(),content:$("#ckeditor").val(),visible:$("#visiblecheckbox").is(":checked"),pos:mb,level:nb,parentpos:null===mb?null:mb-1,language:w()}),data}function _(){return data=JSON.stringify({apikey:apikey,id:$("#entryId").val(),title:$("#title").val(),content:$("#ckeditor").val(),visible:$("#visiblecheckbox").is(":checked"),language:w()}),data}function ab(a){return data=JSON.stringify({apikey:apikey,value:a}),data}function bb(a){return data=JSON.stringify({apikey:apikey,neworder:a,language:w()}),data}function cb(){return data=JSON.stringify({apikey:apikey,title:$("#sitetitle").val(),theme:$("#sitetheme").val(),headline:$("#siteheadline").val(),levels:$("#levelstarget").val(),language:w()}),data}function db(){return data=JSON.stringify({apikey:apikey,email:$("#adminemail").val()}),data}function eb(){return data=JSON.stringify({apikey:apikey,email:$("#newuseremail").val()}),data}function fb(a){return data=JSON.stringify({apikey:apikey,language:a}),data}b["true"]=a,fade=function(a){$(a).delay(10).fadeToggle("slow","linear").delay(1500).fadeToggle("slow","linear")},usermailvalidate=function(a){return a.indexOf(".")>2&&a.indexOf("@")>0?(n(),!0):($("#submituserbtn").after('<br><div class="descr error">Keine gültige Emailadresse</div>'),void console.log("Email nicht gueltig bei useremail"))},adminmailvalidate=function(a){return a.indexOf(".")>2&&a.indexOf("@")>0?(m(),!0):($("#updateadminbtn").after('<br><div class="descr error">Keine gültige Emailadresse</div>'),void console.log("Email nicht gueltig bei adminemail"))},showRight=function(a){$(".rightpanel").each(function(){$(this).hide()}),a.match("^#")?$(a).show():$("#"+a).show()},$("img").error(function(){$(this).attr("src","static/img/bgbig.png")}),init=function(){console.log("init"),$("#logo").click(c),$("#linknew").click(e),$("#prefbtn").click(g),$("#lang-sel").change(s),$(".closepopup").click(d),$(".popupoverflow").click(d),$(".popupcontent").click(function(a){a.stopPropagation()}),$("#submitlangbtn").click(t),$("#updatesiteinfobtn").click(l),$("#siteprefsbtn").click(p)},dragMenu=function(){console.log("dragMenu");var a=$("#menu_list");a.sortable({placeholder:"dragger_placeholder",handle:".dragger",opacity:.7,delay:150,appendTo:document.body,update:function(){console.log("update");var a=$("#menu_list").sortable("toArray");console.log(a),$.ajax({type:"PUT",contentType:"application/json",url:lb+"/entries/neworder",dataType:"json",data:bb(a),error:function(a,b,c){console.log("newOrder error: "+b+c)}})}}),a.disableSelection()},$(document).ready(init()),onLoad=function(){$("#loader").hide(),c(),C(),E(),J(),B(),dragMenu(),x(),A(),$("#page").fadeToggle(800),$(".head").fadeToggle(800),$("#deletebutton").hide(),$("#leveloption").hide(),$("#menu_list").sortable("refresh"),$("textarea#ckeditor").ckeditor()};{var gb,hb,ib,jb,kb,lb="../api/index.php",mb=null,nb=0;w()}}({},function(){return this}());
//# sourceMappingURL=ws.min.js.map