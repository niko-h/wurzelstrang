function updatesiteinfobtn(){return putSiteInfo(),!1}function getSiteInfo(){$.ajax({type:"GET",url:rootURL+"/siteinfo/"+getLanguage(),dataType:"json",success:function(a){console.log("getSiteInfo success: "+a.siteinfo.site_title),siteinfo=a.siteinfo,renderSiteInfo(siteinfo)}})}function putSiteInfo(){console.log("putSiteInfo"),$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/siteinfo",dataType:"json",data:updateSiteInfoToJSON(),success:function(){fade("#savedfade"),getSiteInfo(),getAllSiteNames()},error:function(a,b){alert("putSiteInfo error: "+b)}})}function renderSiteInfo(a){$("title").text(a.site_title+" - bearbeiten"),$("#head-sitelink").html("<b>"+a.site_title+' <i class="icon-angle-right"></i></b>'),$("#sitetitle").val(a.site_title),$("#siteheadline").val(a.site_headline),$("#sitetheme").val(a.site_theme),$("#levelstarget").val(a.site_levels),$("#levels .btn").removeClass("btn-active"),button()}function updateSiteInfoToJSON(){return data=JSON.stringify({apikey:apikey,title:$("#sitetitle").val(),theme:$("#sitetheme").val(),headline:$("#siteheadline").val(),levels:$("#levelstarget").val(),language:getLanguage()}),data}function openlanguagesbtn(){return $(".editlanguagespopup").show(),!1}function langsel(){var a=$(".lang-sel").val();null!==$.cookie("LANGUAGE")&&$.removeCookie("LANGUAGE"),$.cookie("LANGUAGE",a),console.log("newLang: "+a),$("#changedlangfade").html(getLanguage()),fade("#changedlangfade"),"block"!==$("#preferences").css("display")&&showRight(""),getAllSiteNames(),getSiteInfo(),currentEntry=""}function submitnewlang(){var a=$("input#newlanguage").val();""!==a&&postLanguage(a)}function deletelangbutton(){return confirm("[OK] drücken um die Sprache "+$(this).data("lang")+" zu löschen.")?(deleteLanguage($(this).data("lang")),!1):void 0}function getLanguage(){return $.cookie("LANGUAGE")}function getLanguages(){console.log("getLanguages"),$.ajax({type:"GET",url:rootURL+"siteinfo?apikey="+apikey,dataType:"json",success:function(a){languages=a.siteinfo.languages,renderLanguages(".lang-sel")}})}function postLanguage(a){console.log("postLanguage"),$.ajax({type:"POST",contentType:"application/json",url:rootURL+"/siteinfo",dataType:"json",data:langToJSON(a),success:function(){console.log("postLang success"),fade("#savedfade"),getLanguages(),$("#newlanguage").val(""),getAllSiteNames()},error:function(a){a.responseText.indexOf("UNIQUE")>-1&&alert("Diese Sprache existiert bereits."),console.log("postLang error: "+a.responseText),getLanguages(),$("#newlanguage").val("")}})}function deleteLanguage(a){$.ajax({type:"DELETE",url:rootURL+"/siteinfo/"+a,data:JSON.stringify({apikey:apikey}),success:function(){console.log("deleteLangSuccess: "+a),fade("#deletedfade"),getLanguages(),$.cookie("LANGUAGE")==a&&($.removeCookie("LANGUAGE"),$.cookie("LANGUAGE",languages[0])),getSiteInfo(),getAllSiteNames()},error:function(){alert("deleteUser error: "+$("#user").val())}})}function renderLanguages(a){$(a).html($("<option disabled>").html("Sprache/Language")),$(".language-list").html(""),$.each(languages,function(b,c){$(a).append($("<option></option>").val(c).html(c).attr("selected",c==siteinfo.site_language)),$(".language-list").append($("<li>").addClass("push").append(c).append(siteinfo.default_language!==c?$('<a href="#">').addClass("deletelangbutton btn redbtn push-right").attr("data-lang",c).text("Löschen"):""))}),$(".deletelangbutton").unbind().click(deletelangbutton)}function langToJSON(a){return data=JSON.stringify({apikey:apikey,language:a}),data}function linkhello(){return showRight("hello"),$(".menu-id").hide(),!1}function closepopup(){$(".popupoverflow").hide()}function linknew(){return showRight("edit"),newEntry(),!1}function addChild(){console.log("addChild");var a=$(this).data("level"),b=$(this).data("pos");newLevel=a+1,newPos=b+1,linknew()}function prefbtn(){return console.log("einstellungen"),$("#hello").hide(),$("#edit").hide(),$("#preferences").toggle(),!1}function menulink(){console.log("menulink"),showRight("edit"),getEntry($(this).data("identity"))}function newEntry(){currentEntry={},renderEntry(currentEntry)}function getAllSiteNames(){console.log("getAllSiteNames"),$.ajax({type:"GET",url:rootURL+"/entries/"+getLanguage()+"?apikey="+apikey,dataType:"json",success:function(a){console.log("getAllSiteNames success"),renderList(a),sitelist=a}})}function renderList(a){console.log("renderList");var b=null===a.entries?[]:a.entries instanceof Array?a.entries:[a.entries];$("#menu_list li").remove();var c="",d=$("#levelstarget").val()&&isadmin;isadmin&&(c='<span class="dragger push-right"><i class="icon-drag"></i></span></li>'),$.each(b,function(a,b){if(visible_class=b.visible?[]:" ishidden",visible_icon=b.visible?[]:'<i class="icon-eye-shut eyeshut"></i>',visible_popup=b.visible?[]:'<span class="tooltip"><span>Wird auf der Webseite derzeit nicht angezeigt.</span></span>',levels="",d&&b.level>=1)for(var e=0;e<b.level;e++)levels+='<span class="levels"></span>';var f="";d&&(f='<a href="#" class="addChild-Button" data-level="'+b.level+'" data-identity="'+b.id+'"data-pos="'+b.pos+'"><span class="tooltip"><span>Unterseite erstellen</span></span>+</a>'),$("#menu_list").append('<li id="'+b.id+'" class="row-split'+visible_class+'"><a href="#" class="menulink row-split" data-identity="'+b.id+'">'+levels+"<b>"+b.title+'</b><i class="icon-edit edit"></i> '+visible_icon+visible_popup+"</a>"+f+c)}),isadmin||$("a.menulink").css("width","246px"),d&&$("a.menulink").addClass("smallMenulink"),$("#menu_list li a.menulink").unbind().click(menulink),$(".addChild-Button").unbind().click(addChild)}function newOrderToJSON(a){return data=JSON.stringify({apikey:apikey,neworder:a,language:getLanguage()}),data}function adduserbtn(){return renderUser(),!1}function isadmincheckbox(){var a=$(".isadmincheckbox").prop("checked");return a?$(".userpopup-sitelist-container").hide():$(".userpopup-sitelist-container").show(),!1}function editusrbtn(){return getUserPrefs($(this).data("identity")),!1}function deleteusrbtn(){return confirm("[OK] drücken um den User zu löschen.")?($(".userpopup").hide(),deleteUser($(this).data("identity")),!1):void 0}function getUsers(a){$.ajax({type:"GET",url:rootURL+"/users?apikey="+apikey,dataType:"json",success:function(b){console.log("getUsers success"),a(b)}})}function putUser(a,b){$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/users/"+a,dataType:"json",data:userToJSON(),success:function(a){console.log("putUser success"),fade("#savedfade"),updateAdminSites(a.id,b),getUsers(renderUserList),$("#newuseremail").val(""),$(".userpopup").hide()},error:function(a,b){alert("putAdmin error: "+b)}})}function postUser(a){$.ajax({type:"POST",contentType:"application/json",url:rootURL+"/users",dataType:"json",data:userToJSON(),success:function(b){console.log("postUser success"),fade("#savedfade"),updateAdminSites(b.id,a),getUsers(renderUserList),$("#newuseremail").val(""),$(".userpopup").hide()},error:function(a){a.responseText.indexOf("UNIQUE")>-1&&alert("Dieser Nutzer existiert bereits."),console.log("postUser error: "+a.responseText),getUsers(renderUserList),$("#newuseremail").val("")}})}function getUserPrefs(a){console.log("getUserPrefs"),$.ajax({type:"GET",url:rootURL+"/users/"+a+"?apikey="+apikey,dataType:"json",success:function(a){getAllSiteNames(),renderUser(a)},error:function(a,b){alert("getUser error: "+b)}})}function deleteUser(a){$.ajax({type:"DELETE",url:rootURL+"/users/"+a,data:JSON.stringify({apikey:apikey}),success:function(){console.log("deleteUsersuccess: "+a),fade("#deletedfade"),getUsers(renderUserList)},error:function(){alert("deleteUser error: "+$("#user").val())}})}function updateAdminSites(a,b){"undefined"==typeof b&&(b=adminsitesToJSON()),console.log("addAdminsites"),$.ajax({type:"POST",contentType:"application/json",url:rootURL+"/users/"+a+"/sites/"+getLanguage(),dataType:"json",data:b,success:function(){console.log("addAdminsites success")},error:function(a,b){console.log("addAdminsites error: "+b)}})}function renderUserList(a){console.log("renderUserList");var b=null===a.users?[]:a.users instanceof Array?a.users:[a.users];$(".admin-list li").remove(),$(".user-list li").remove(),$.each(b,function(a,b){"1"===b.admin||"on"===b.admin?(ac+=1,$(".admin-list").append(b.user_email===current_admin?$("<li>").addClass("push").append(b.user_email):$("<li>").addClass("push").append(b.user_email).append($('<a href="#">').addClass("editusrbutton btn push-right").attr("data-identity",b.id).text("Bearbeiten")))):$(".user-list").append($("<li>").addClass("push").append(b.user_email).append($('<a href="#">').addClass("editusrbutton btn push-right").attr("data-identity",b.id).text("Bearbeiten")))}),$(".editusrbutton").unbind().click(editusrbtn)}function renderUser(a){$(".userpopup").show(),console.log(a),renderTemplateList("#usertemplate");var b=null===sitelist.entries?[]:sitelist.entries instanceof Array?sitelist.entries:[sitelist.entries];if($(".userpopup-sitelist li").remove(),$.each(b,function(a,b){$(".userpopup-sitelist").append($("<li>").append($("<input>").addClass("userpopupcheckbox").attr("type","checkbox").attr("data-id",b.id).after($("<label>").addClass("bold popuplistlabel").text(b.title))))}),"undefined"==typeof a)console.log("renderNewUser"),$(".userpopuptitle").text("Neuen Benutzer anlegen"),$("#useremail").val(""),$("#submitsiteprefs").removeAttr("data-id");else{console.log("renderUser"),$(".userpopuptitle").text(a.user_email+" - Eigenschaften"),console.log(a.id),$("#submitsiteprefs").attr("data-id",a.id),$("#useremail").val(a.user_email),"1"===a.admin&&($(".isadmincheckbox").prop("checked","checked"),isadmincheckbox());var c=null===a.sites?[]:a.sites instanceof Array?a.sites:[a.sites];$.each(c,function(a,b){$(".userpopup-sitelist input.userpopupcheckbox[data-id="+b+"]").attr("checked","checked")}),"1"===a.admin?$("#deleteusrbutton").hide():($("#deleteusrbutton").show(),$("#deleteusrbutton").attr("data-identity",a.id),$("#deleteusrbutton").unbind().click(deleteusrbtn))}}function userToJSON(){return data=JSON.stringify({apikey:apikey,admin:$(".isadmincheckbox").is(":checked"),email:$("#useremail").val()}),data}function adminsitesToJSON(){var a=[];return $(".userpopupcheckbox:checked").each(function(){a.push($(this).attr("data-id"))}),data=JSON.stringify({apikey:apikey,sites:a}),data}function submitsitebutton(){return""!==$("#title").val()?(""===$("#entryId").val()?addEntry():updateEntry(),!1):void 0}function deleteentrybtn(){return confirm("[OK] drücken um den Eintrag zu löschen.")?($(".editpopup").hide(),$("#edit").hide(),deleteEntry($(this).data("id")),!1):void 0}function levelup(){var a=parseFloat($("#levelcount").text());return a++,updateLevel(a),!1}function leveldown(){var a=parseFloat($("#levelcount").text());return a>=1&&a--,updateLevel(a),!1}function editsitebutton(){return $(".site-prefs").toggle(),!1}function showsiteaminpopup(){return getUsers(renderSiteadminsPopup),!1}function submitsiteadmins(){return""!==$("#entryId").val()?(console.log("call updateSiteadmins()"),updateSiteadmins($("#entryId").val()),closepopup(),fade("#savedfade")):(console.log("just close the popup"),closepopup()),!1}function getTemplates(){console.log("getTemplates"),$.ajax({type:"GET",url:rootURL+"availableTemplates?apikey="+apikey,dataType:"json",success:function(a){templates=a}})}function getEntry(a){console.log("getEntry"),$.ajax({type:"GET",url:rootURL+"/entries/"+getLanguage()+"/"+a+"?apikey="+apikey,dataType:"json",success:function(a){$("#deletebutton").show(),currentEntry=a,renderEntry(currentEntry)},error:function(a,b){alert("getEntry error: "+b)}})}function addEntry(){console.log("addEntry");var a=siteadminsToJSON();$.ajax({type:"POST",contentType:"application/json",url:rootURL+"/entries/"+getLanguage(),dataType:"json",data:newEntryToJSON(),success:function(b){fade("#savedfade"),console.log("INSERTED: "+b.inserted.id),getEntry(b.inserted.id),updateSiteadmins(b.inserted.id,a),getAllSiteNames(),newPos=null,newLevel=0},error:function(a,b){newPos=null,newLevel=0,alert("addEntry error: "+b)}})}function updateEntry(){console.log("updateEntry");var a=$("#entryId").val();$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/entries/"+getLanguage()+"/"+a,dataType:"json",data:updateEntryToJSON(),success:function(){fade("#savedfade"),updateSiteadmins(a),getEntry(a),getAllSiteNames()},error:function(a,b){alert("updateEntry error: "+b)}})}function deleteEntry(a){console.log("deleteEntry"),$.ajax({type:"DELETE",url:rootURL+"/entries/"+getLanguage()+"/"+a,data:JSON.stringify({apikey:apikey}),success:function(){fade("#deletedfade"),getAllSiteNames()},error:function(){alert("deleteEntry error")}})}function updateLevel(a){console.log("updateLevel"),console.log(a),$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/entries/"+getLanguage()+"/"+$("#entryId").val()+"/level",dataType:"json",data:updateLevelToJSON(a),success:function(){getEntry($("#entryId").val()),getAllSiteNames()},error:function(a,b){alert("updateEntry error: "+b)}})}function updateSiteadmins(a,b){"undefined"==typeof b&&(b=siteadminsToJSON()),console.log("addSiteadmins"),$.ajax({type:"POST",contentType:"application/json",url:rootURL+"/entries/"+getLanguage()+"/"+a+"/siteadmins",dataType:"json",data:b,success:function(){console.log("addSiteadmins success")},error:function(a,b){console.log("addSiteadmins error: "+b)}})}function renderEntry(a){var b;b="undefined"==typeof a.template?"ws-edit-default":a.template,$("#edit_main").load("templates/"+b,function(){$(".submitsitebutton").unbind().click(submitsitebutton),$(".editsitebutton").unbind().click(editsitebutton),$("#leveldown").unbind().click(leveldown),$("#levelup").unbind().click(levelup),$(".showsiteaminpopup").click(showsiteaminpopup),$(".site-prefs").hide(),renderTemplateList("#templateSelector"),$(".editsitebutton").show();var b=a.entry;b&&"string"!==b.id?(date=new Date(1e3*b.mtime).toUTCString(),$("#editlegend").html('<i class="icon-edit"></i> Seite bearbeiten <span id="time">(letzte &Auml;nderung: '+date+"</span>"),$("#entryId").val(b.id),$("#title").val(b.title),$("#siteprefsbtn").attr("data-id",b.id),$("textarea#ckeditor").val(b.content),$("#levelcount").text(b.level),"1"===$("#levelstarget").val()?($("#leveloption").show(),$("#leveloption .btn-group").show()):$("#leveloption").hide(),"1"===b.visible?$("#visiblecheckbox").attr("checked","checked"):$("#visiblecheckbox").removeAttr("checked"),$("#deleteentrybutton").attr("data-id",b.id),$("#deleteentrybutton").unbind().click(deleteentrybtn)):(console.log("newSite"),$(".deleteoption").hide(),$("#editlegend").html('<i class="icon-pencil"></i> Neue Seite'),$("#entryId").val(""),$("#title").val("").focus(),$("#visiblecheckbox").attr("checked","checked"),$("textarea#ckeditor").val(""),"1"===$("#levelstarget").val()?($("#leveloption").show(),$("#leveloption .btn-group").hide()):$("#leveloption").hide())})}function renderSiteadminsPopup(a){console.log("renderSiteadminsPopup"),$(".editsiteadminspopup").show();var b=null===a.users?[]:a.users instanceof Array?a.users:[a.users];if($(".editsiteadminspopup-userlist li").remove(),$.each(b,function(a,b){$(".editsiteadminspopup-userlist").append($("<li>").append($("<input>").addClass("editsiteadminspopupcheckbox").attr("type","checkbox").attr("data-id",b.id).attr("data-mail",b.user_email)).append($("<label>").addClass("bold").text(b.user_email)))}),"undefined"==typeof currentEntry.entry)$('.editsiteadminspopupcheckbox[data-mail="'+current_admin+'"]').attr("checked","checked");else{var c=null===currentEntry.entry.siteadmins?[]:currentEntry.entry.siteadmins instanceof Array?currentEntry.entry.siteadmins:[currentEntry.entry.siteadmins];$.each(c,function(a,b){$(".editsiteadminspopup-userlist input.editsiteadminspopupcheckbox[data-id="+b+"]").attr("checked","checked")})}$("#submitsiteadmins").unbind().click(submitsiteadmins)}function renderTemplateList(a){console.log("renderTemplateList"),$(a).html(""),$.each(templates,function(b,c){var d=c;"ws-edit-default"===d&&(d="default"),"ws-"!==d.substring(0,3)&&$(a).append($("<option></option>").val(c).html(d).attr("selected",function(){if("undefined"!=typeof currentEntry&&"undefined"!=typeof currentEntry.entry&&"undefined"!=typeof currentEntry.entry.template){if(c===currentEntry.entry.template)return"selected"}else if("default"===d)return"selected"}))})}function newEntryToJSON(){return data=JSON.stringify({apikey:apikey,title:$("#title").val(),content:$("#ckeditor").val(),visible:$("#visiblecheckbox").is(":checked"),pos:newPos,level:newLevel,parentpos:null===newPos?null:newPos-1,language:getLanguage(),template:$("#templateSelector").val()}),data}function updateEntryToJSON(){return data=JSON.stringify({apikey:apikey,id:$("#entryId").val(),title:$("#title").val(),content:$("#ckeditor").val(),visible:$("#visiblecheckbox").is(":checked"),language:getLanguage(),template:$("#templateSelector").val()}),data}function updateLevelToJSON(a){return data=JSON.stringify({apikey:apikey,value:a}),data}function siteadminsToJSON(){var a=[];return $(".editsiteadminspopupcheckbox:checked").each(function(){a.push($(this).attr("data-id"))}),data=JSON.stringify({apikey:apikey,siteadmins:a}),data}init=function(){console.log("init"),$("html").click(function(){$(".site-prefs").hide()}),$("#logo").click(linkhello),$("#linknew").click(linknew),$("#prefbtn").click(prefbtn),$(".adduserbtn").click(adduserbtn),$(".isadmincheckbox").change(isadmincheckbox),$(".openlanguagesbtn").click(openlanguagesbtn),$(".lang-sel").change(langsel),$("#submitlangbtn").click(submitnewlang),$(".closepopup").click(closepopup),$(".popupoverflow").click(closepopup),$(".popup, .site-prefs").click(function(a){a.stopPropagation()}),$("#updatesiteinfobtn").click(updatesiteinfobtn)},onLoad=function(){console.log("onLoad"),$("#loader").hide(),linkhello(),getSiteInfo(),getAllSiteNames(),getUsers(renderUserList),dragMenu(),getLanguages(),getTemplates(),$("#page").fadeToggle(800),$(".head").fadeToggle(800),$("#deletebutton").hide(),$("#leveloption").hide(),$("#menu_list").sortable("refresh"),$("textarea#ckeditor").ckeditor()};var rootURL="../api/index.php",langSelected=getLanguage(),siteinfo,languages,sitelist;dragMenu=function(){console.log("dragMenu");var a=$("#menu_list");a.sortable({placeholder:"dragger_placeholder",handle:".dragger",opacity:.7,delay:150,appendTo:document.body,update:function(){console.log("update");var a=$("#menu_list").sortable("toArray");console.log(a),$.ajax({type:"PUT",contentType:"application/json",url:rootURL+"/entries/neworder",dataType:"json",data:newOrderToJSON(a),error:function(a,b,c){console.log("newOrder error: "+b+c)}})}}),a.disableSelection()};var user={},ac=0;usermailvalidate=function(a){return a.indexOf(".")>2&&a.indexOf("@")>0?("undefined"!=typeof $("#submitsiteprefs").data("id")?putUser($("#submitsiteprefs").data("id"),adminsitesToJSON()):postUser(adminsitesToJSON()),!0):($("#useremail").after('<br><div class="descr error">Keine gültige Emailadresse</div>'),void console.log("Email nicht gueltig bei useremail"))};var currentEntry,templates,newPos=null,newLevel=0;fade=function(a){$(a).delay(10).fadeToggle("slow","linear").delay(1500).fadeToggle("slow","linear")},showRight=function(a){$(".rightpanel").each(function(){$(this).hide()}),a.match("^#")?$(a).show():$("#"+a).show()},$("img").error(function(){$(this).attr("src","static/img/bgbig.png")}),$(document).ready(init());
//# sourceMappingURL=ws.min.js.map